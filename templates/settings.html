{% extends 'base.html' %}
{% block title %}Pattern Finder — Settings{% endblock %}
{% block content %}
  <div class="card">
    <h1 style="margin-top:0;">Settings</h1>
    <form action="/settings/save" method="post">
      <div class="grid">
        <div>
          <label>SMTP User</label>
          <input name="smtp_user" value="{{ st['smtp_user'] or '' }}" />
        </div>
        <div>
          <label>SMTP Pass</label>
          <input name="smtp_pass" type="password" value="{{ st['smtp_pass'] or '' }}" />
        </div>
        <div>
          <label>Scanner Results Recipients (comma-separated)</label>
          <input name="scanner_recipients" value="{{ st['scanner_recipients'] or '' }}" />
        </div>
        <div>
          <label>Favorites Alert Recipients (comma-separated)</label>
          <input name="recipients" value="{{ st['recipients'] or '' }}" />
        </div>
        <div>
          <label>Enable Favorites Scheduler</label>
          <select name="scheduler_enabled">
            <option value="1" {% if st['scheduler_enabled']==1 %}selected{% endif %}>Yes</option>
            <option value="0" {% if st['scheduler_enabled']==0 %}selected{% endif %}>No</option>
          </select>
        </div>
        <div>
          <label>Throttle Window (minutes)</label>
          <input name="throttle_minutes" type="number" step="1" value="{{ st['throttle_minutes'] or 60 }}" />
        </div>
      </div>

  <div class="actions">
    <button type="submit">Save</button>
    <p class="note">
      Current boundary: <strong>{{ st['last_boundary'] or '—' }}</strong> &nbsp;•&nbsp;
      Last run at: <strong>{{ st['last_run_at'] or '—' }}</strong>
    </p>
  </div>
    </form>
  </div>
  <div class="card" style="margin-top:1rem;">
    <div class="card-body">
      <strong>Favorites Alerts</strong>
      <div class="grid" style="margin-top:.5rem;">
        <div>
          <label>Symbol</label>
          <input id="fav-test-symbol" value="AAPL" />
        </div>
        <div>
          <label>Channel</label>
          <select id="fav-test-channel">
            <option value="mms">MMS</option>
            <option value="email">Email</option>
          </select>
        </div>
        <div>
          <label>Compact</label>
          <select id="fav-test-compact">
            <option value="0">Verbose</option>
            <option value="1">Compact</option>
          </select>
        </div>
      </div>
      <button id="fav-test-send" class="btn" style="margin-top:.5rem;">Send Test Alert</button>
    </div>
  </div>
{% endblock %}
{% block extra_body %}
<script>
  document.getElementById('fav-test-send')?.addEventListener('click', async ()=>{
    const symbol = document.getElementById('fav-test-symbol').value || 'AAPL';
    const channel = document.getElementById('fav-test-channel').value || 'mms';
    const compact = document.getElementById('fav-test-compact').value === '1';
    await fetch('/favorites/test_alert',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({symbol,channel,compact})});
  });
</script>
{% endblock %}
