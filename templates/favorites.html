{% extends 'base.html' %}
{% block title %}Pattern Finder â€” Favorites{% endblock %}
{% block content %}
  <div class="card">
    <h1 style="margin-top:0;">Favorites</h1>
    {% if favorites and favorites|length %}
    <div class="actions">
      <form method="post" action="/favorites/delete-duplicates" style="margin:0;">
        <button type="submit">Remove Duplicates</button>
      </form>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Ticker</th>
          <th>Direction</th>
          <th>Interval</th>
          <th>ROI%</th>
          <th>Hit%</th>
          <th>DD%</th>
          <th>Snapshot At</th>
          <th>Forward (latest)</th>
          <th>Rule</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for f in favorites %}
        <tr>
          <td>{{ f["id"] }}</td>
          <td><strong>{{ f["ticker"] }}</strong></td>
          <td>{{ f["direction"] }}</td>
          <td>{{ f["interval"] }}</td>
          <td>{{ '{:.0f}'.format(f['roi_snapshot']*100 if f['roi_snapshot'] is not none and f['roi_snapshot'] <= 1 else f['roi_snapshot']) if f['roi_snapshot'] is not none else '' }}</td>
          <td>{{ '{:.1f}'.format(f['hit_snapshot']) if f['hit_snapshot'] is not none else '' }}</td>
          <td>{{ '{:.0f}'.format(f['dd_snapshot']*100 if f['dd_snapshot'] is not none and f['dd_snapshot'] <= 1 else f['dd_snapshot']) if f['dd_snapshot'] is not none else '' }}</td>
          <td>{{ f['snapshot_at'][:16] if f['snapshot_at'] else '' }}</td>
          <td>
            {% if f['forward_roi_pct'] is not none %}
            <span class="badge">Forward ROI {{ '{:.0f}'.format(f['forward_roi_pct']*100 if f['forward_roi_pct'] <= 1 else f['forward_roi_pct']) }} | Hit {{ '{:.1f}'.format(f['forward_hit_pct']) }} | DD {{ '{:.0f}'.format(f['forward_dd_pct']*100 if f['forward_dd_pct'] <= 1 else f['forward_dd_pct']) }}</span>
            {% endif %}
          </td>
          <td><code>{{ f["rule"] }}</code></td>
          <td>
            <form method="post" action="/favorites/delete/{{ f['id'] }}" style="margin:0;">
              <button type="submit" class="del-btn">&#10005;</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p>No favorites yet. Right-click a row in Results to add one.</p>
    {% endif %}
  </div>
{% endblock %}
